<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Loch Leven – Hiking Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    html, body, #map { height: 100%; margin: 0; }
    .msg { position:absolute; top:10px; left:10px; background:#fff; padding:6px 8px; border-radius:6px; box-shadow:0 1px 6px rgba(0,0,0,.15); font:14px/1.3 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
    .legend { position:absolute; bottom:12px; left:12px; background:#fff; padding:6px 8px; border-radius:6px; box-shadow:0 1px 6px rgba(0,0,0,.15); }
    .swatch { display:inline-block; width:18px; height:3px; background:#e74c3c; margin-right:6px; vertical-align:middle; }
  </style>
</head>
<body>
<div id="map"></div>
<div id="msg" class="msg" style="display:none"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([37.7749, -122.4194], 12);
  L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19, attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);
  L.control.scale({ metric:false }).addTo(map);

  const showMsg = (t) => { const el = document.getElementById('msg'); el.textContent = t; el.style.display = 'block'; };

  // GeoJSON sits in the repo root
  const GEOJSON_URL = './loch.levens.geojson?v=' + Date.now(); // cache-bust while iterating

  fetch(GEOJSON_URL)
    .then(r => { if (!r.ok) throw new Error(`HTTP ${r.status} loading ${GEOJSON_URL}`); return r.json(); })
    .then(geo => {
      const trail = L.geoJSON(geo, {
        style: { color:'#e74c3c', weight:3 },
        onEachFeature: (f, layer) => {
          const name = f?.properties?.name || 'Trail';
          layer.bindPopup(name);
        }
      }).addTo(map);

      const b = trail.getBounds();
      if (b.isValid()) map.fitBounds(b, { padding:[20,20] });
      else showMsg('Loaded GeoJSON but it has no visible geometry (empty or out of range).');
    })
    .catch(err => {
      console.error(err);
      showMsg('Could not load loch.levens.geojson. Check filename, path, and that it’s valid GeoJSON.');
    });

  // Tiny legend
  const legend = L.control({ position:'bottomleft' });
  legend.onAdd = () => {
    const div = L.DomUtil.create('div', 'legend');
    div.innerHTML = '<div><span class="swatch"></span>Hiking trail</div>';
    return div;
  };
  legend.addTo(map);
</script>
</body>
</html>
